\documentclass{article}

\usepackage{listings}

\lstset{%
  basicstyle=\ttfamily,
}

\title{Sparkle user guide}
\author{Koen van der Blom}
\date{\today}

\begin{document}

\maketitle

\section{Settings}

\subsection{Slurm (focused on Grace)}
Slurm settings can be specified in the \texttt{Settings/sparkle\_slurm\_settings.txt} file. Note that a number of Sparkle commands internally call the \texttt{srun} command, and for those commands the provided settings need to match the restrictions of your call to a Sparkle command. Take for instance the following command:

\begin{lstlisting}[breaklines]
srun -N1 -n1 -p graceTST Commands/configure_solver.py -solver Solvers/Yahsp3 -instances-train Instances/Depots_train_few/
\end{lstlisting}

This call restricts itself to the \texttt{graceTST} partition (the \texttt{graceTST} partition only consists of node 22). So if the settings file contains the setting \texttt{--exclude=ethnode22}, all available nodes are excluded, and the command cannot execute any internal \texttt{srun} commands it may have.

Finally, Slurm ignores nested partition settings for \texttt{srun}, but not for \texttt{sbatch}. This means that if you specify the \texttt{graceTST} partition (as above) in your command, but the \texttt{graceADA} partition in the settings file, Slurm will still execute any nested \texttt{srun} commands on the \texttt{graceTST} partition only.

\section{Required packages}

\subsection{On Grace}

Grace is the computing cluster of the ADA group\footnote{\texttt{http://ada.liacs.nl/}} at LIACS, Leiden University. Since not all packages required by Sparkle are installed on the system, some have to be installed local to the user.

Specifically, \texttt{epstopdf} is required for Sparkle's reporting component to work (e.g. \texttt{generate\_report, generate\_report\_for\_configuration}), it can be installed in your user directory as follows:

\begin{enumerate}
  \item Download \texttt{epstopdf}

  \texttt{wget http://mirrors.ctan.org/support/epstopdf.zip}

  \item Unzip the package

  \texttt{unzip epstopdf.zip}

  \item Rename \texttt{epstopdf.pl} (inside the directory you just unzipped)

  \texttt{mv epstopdf.pl epstopdf}

  \item Add this line to your \texttt{.bashrc} (open with e.g. \texttt{vim \~{}/.bashrc})

  \texttt{export PATH="/<directory>/epstopdf:\$PATH"}

  (replace "\texttt{<directory>}" with the path to the \texttt{epstopdf} directory)
\end{enumerate}

\subsection{Yahsp example}

\begin{enumerate}

  \item Install gmp on Grace

  \texttt{wget https://gmplib.org/download/gmp/gmp-6.1.2.tar.xz}

  \texttt{tar -xf gmp-6.1.2.tar.xz}

  Inside the \texttt{gmp-6.1.2} directory:

  \texttt{./configure}

  \texttt{make}

  \texttt{make check}

  \item Navigate to the \texttt{seq-agl-yahsp3} directory

  \item Add the below after \texttt{-fpermissive} on line 24 of \texttt{cpt-yahsp/CMakeLists.txt}:

  \texttt{ -I /home/blomkvander/lib/gmp-6.1.2/ -L /home/blomkvander/lib/gmp-6.1.2/.libs/}

  (replace \texttt{/home/blomkvander/lib/} with the path where you installed gmp)

  \item Compile yahsp with:

  \texttt{./build}

  \item In \texttt{yahsp/esegui.sh} the line \texttt{\#!/bin/bash} was added to the start of the file to allow Grace nodes to find the 'time' utility.

\end{enumerate}

\end{document}
