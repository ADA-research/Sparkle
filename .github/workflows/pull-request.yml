name: Python Package using Conda

on: [pull_request]

jobs:
  build-linux:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 5

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: true
    - name: Conda install
      uses: conda-incubator/setup-miniconda@v3
      with:
        auto-update-conda: true
        python-version: 3.9
        environment-file: environment.yml
        activate-environment: sparkle
        auto-activate-base: false
    - name: Lint with flake8
      run: |
        pip install flake8==5.0.4 flake8-quotes==3.3.1 flake8-bandit==4.1.1 pep8-naming==0.13.2 flake8-docstrings==1.6.0 flake8-use-fstring==1.4.0 flake8-use-pathlib==0.3.0 flake8-annotations==3.0.1
        # stop the build if there are Python syntax errors or undefined names
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
    - name: Test with pytest
      run: |
        pip install pytest pytest-mock==3.10.0
        pytest
    - name: Archive outputs
      uses: actions/upload-artifact@v4
      if: failure()
      with:
       name: output
       path: Output/
       retention-days: 5
  # build-mac:
  #   runs-on: macos-latest
  #   strategy:
  #     max-parallel: 5

  #   steps:
  #   - uses: actions/checkout@v4
  #     with:
  #       submodules: true
  #   - name: Conda install
  #     uses: conda-incubator/setup-miniconda@v2
  #     with:
  #       auto-update-conda: true
  #       python-version: 3.9
  #       environment-file: environment.yml
  #   - name: Lint with flake8
  #     run: |
  #       pip install flake8
  #       # stop the build if there are Python syntax errors or undefined names
  #       flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
  #       # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
  #       flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
  #   - name: Test with pytest
  #     run: |
  #       pytest
  #   - name: Archive outputs
  #     uses: actions/upload-artifact@v4
  #     if: failure()
  #     with:
  #      name: output
